let pokemon={name:'',id:'',detailsUrl:''};let pokemonRepository=(function(){let pokemonList=[];let apiUrl='';let pageOffset=getOffset();if(pageOffset){apiUrl=('https://pokeapi.co/api/v2/pokemon/?limit=100&offset='+pageOffset)}else{apiUrl='https://pokeapi.co/api/v2/pokemon/?limit=100'}
console.log(pageOffset);console.log(apiUrl);function getAll(){return pokemonList}
function addListItem(pokemon){let documentList=$('.pokemon-list');let listItem=$('<li></li>');listItem.addClass('list-item','list-group-item-action');let button=$('<button></button>');button.attr('type','button');button.attr('data-toggle','modal');button.attr('data-target','#modal-container');button.addClass('pokemon-button','btn','btn-primary');button.text(pokemon.id+'. '+pokemon.name);buttonClick(button,pokemon);listItem.append(button);documentList.append(listItem)}
function buttonClick(button,pokemon){button.on('click',function(){showDetails(pokemon)})}
function getOffset(){let urlParams=new URLSearchParams(window.location.search);let offset=urlParams.get('offset');if(offset){return offset}else{return null}}
function loadList(){return fetch(apiUrl).then(function(response){return response.json()}).then(function(json){json.results.forEach(function(item){let splitUrl=item.url.slice(0,item.url.length-1).split('https://pokeapi.co/api/v2/pokemon/');console.log(item.url);console.log(splitUrl);let idFromUrl=splitUrl.join('');console.log(idFromUrl);let pokemon={name:item.name.charAt(0).toUpperCase()+item.name.slice(1),id:idFromUrl,detailsUrl:item.url};add(pokemon)})}).catch(function(e){console.error(e)})}
function loadDetails(item){let url=item.detailsUrl;return fetch(url).then(function(response){return response.json()}).then(function(details){item.imageUrl=details.sprites.front_default;item.height=details.height;item.id=details.id}).catch(function(e){console.error(e)})}
function showDetails(pokemon){loadDetails(pokemon).then(function(){$('.modal-title').text('');$('.pokemon-img').attr('src','');$('.pokemon-height').text('');$('.modal-title').text(pokemon.id+'. '+pokemon.name);$('.pokemon-img').attr('src',pokemon.imageUrl);$('.pokemon-img').attr('alt',pokemon.name);$('.pokemon-height').text(pokemon.name+' is '+pokemon.height+' feet tall!\n')})}
function add(item){if(typeof(item)==='object'){let addedKeys=Object.keys(item);let templateKeys=Object.keys(pokemon);if(addedKeys.length===templateKeys.length){let i=0;let success=!1;addedKeys.forEach(function(key){if(key!==templateKeys[i]){console.log('pokemonRepository.add error: key does not match template: '+key);return}else{i++;if((addedKeys.length)===i){success=!0}}});if(success){pokemonList.push(item)}}else{console.log('pokemonRepository.add error: number of keys does not match template')}}else{console.log('pokemonRepository.add error: not an object, item is type: '+typeof(item))}}
return{getAll:getAll,addListItem:addListItem,add:add,showDetails:showDetails,getOffset:getOffset,loadList:loadList,loadDetails:loadDetails}})();pokemonRepository.loadList().then(function(){pokemonRepository.getAll().forEach(function(pokemon){pokemonRepository.addListItem(pokemon)})})